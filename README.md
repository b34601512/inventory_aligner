# StockSyncPro - 库存同步程序

这是一个专门用于同步销售出库单和即时库存表的桌面应用程序。

## 功能特点

- 支持Excel文件上传和处理
- 物料编码批量映射替换
- 智能批次号分配（根据库存量自动分配）
- 仓库信息同步
- 辅助属性自动匹配
- 直观的操作界面和进度提示

## 安装说明

1. 确保已安装Python 3.8+
2. 安装依赖包：
   ```bash
   pip install -r requirements.txt
   ```

## 使用方法

### 方法一：运行Python脚本
1. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

2. 运行程序：
   ```bash
   python main.py
   ```

### 方法二：使用批处理文件（Windows）
```bash
run.bat
```

### 操作步骤
1. **设置物料编码映射**：
   - 在"物料编码映射"区域输入旧料号（如：8.01.1.01.01.206）
   - 输入对应的新料号（如：8.01.1.01.01.233）
   - 点击"添加映射"按钮
   - 可以添加多个映射关系

2. **上传文件**：
   - 点击"销售出库单"旁的"浏览..."按钮，选择Excel文件
   - 点击"即时库存表"旁的"浏览..."按钮，选择Excel文件
   - 程序会自动验证文件格式和必要列

3. **开始处理**：
   - 点击"开始处理"按钮
   - 程序会显示处理进度和详细日志
   - 处理完成后会自动保存并高亮修改内容

### 文件格式要求

**销售出库单表格格式**：
- DZ列：物料编码（如：8.01.1.01.01.206）
- FF列：批号（如：Z25050086）
- FG列：批号（如：Z25050086）
- GJ列：仓库名称（如：成都亚一公共平台仓2号库）
- HA列：销售数量（如：100）

**即时库存表格式**：
- A列：物料编码（如：8.01.1.01.01.233）
- G列：仓库名称（如：成都亚一公共平台仓2号库）
- H列：批号（如：Z25050091）
- K列：可用量（如：161）
- D、E、F列：辅助属性

## 文件结构

- `main.py` - 主程序入口
- `ui_main.py` - 图形用户界面
- `logic.py` - 表格处理逻辑
- `utils.py` - 工具函数

## 注意事项

- 请确保Excel文件格式正确，必须包含所有必要列
- 处理前建议备份原始文件（程序会自动创建备份）
- 程序会直接修改销售出库单文件并标记修改内容为红色
- 物料编码必须符合 x.xx.x.xx.xx.xxx 格式（6段数字，用点分隔）
- 批次号分配会根据库存量自动分配，确保不会超出库存限制
- 程序会自动跳过前两行（标题行），从第三行开始处理数据

## 功能特点

1. **智能批次分配**：根据库存量自动分配批次号，避免超出库存限制
2. **自动备份**：处理前自动创建带时间戳的备份文件
3. **实时日志**：详细的处理过程日志，便于跟踪和调试
4. **错误处理**：完善的错误检查和用户友好的错误提示
5. **多仓库支持**：支持多个仓库的数据同步处理
6. **进度显示**：实时显示处理进度和当前操作状态

## 故障排除

### 常见问题

1. **程序无法启动**：
   - 检查Python版本（需要3.8+）
   - 确保已安装所有依赖：`pip install -r requirements.txt`

2. **文件加载失败**：
   - 检查Excel文件是否损坏
   - 确认文件包含所有必要列
   - 检查文件是否被其他程序占用

3. **物料编码验证失败**：
   - 确认编码格式为 x.xx.x.xx.xx.xxx
   - 检查是否包含非数字字符
   - 确认有6段数字，用点分隔

4. **批次分配异常**：
   - 检查库存表中是否有对应的物料和仓库
   - 确认库存数量足够
   - 检查批次号和库存量数据格式

### 测试程序

运行测试脚本验证基本功能：
```bash
python test_basic.py
```

如果测试通过，说明程序基本功能正常。

## 版本信息

- 版本：1.0
- 开发环境：Python 3.8+ / PyQt5
- 支持平台：Windows 