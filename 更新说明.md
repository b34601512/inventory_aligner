# StockSyncPro 更新说明

## 版本更新内容

### ✅ 问题修复

1. **物料编码修改BUG修复**
   - 修复了物料编码没有正确保存到Excel文件的问题
   - 现在修改的数据会正确写入到openpyxl工作簿并保存
   - 物料编码、批次号的修改都会正确应用到实际文件

2. **空行处理优化**
   - 程序现在能够正确处理Excel表格中的空行
   - 空行不会中断数据处理流程
   - 空行下方的数据会被正常处理

3. **列位置正确映射**
   - 修正了列位置映射：
     - DZ列（物料编码）: 第104列（0-based index: 103）
     - FF列（批次号）: 第136列（0-based index: 135）
     - FG列（批次号）: 第137列（0-based index: 136）
     - GJ列（仓库名称）: 第270列（0-based index: 269）
     - HA列（销售数量）: 第209列（0-based index: 208）

### 🆕 新功能

1. **自动隐藏无用列**
   - 程序会自动隐藏Excel中不需要的列
   - 只保留重要的列可见：物料编码、批次号、仓库名称、销售数量
   - 便于用户对比和检查修改结果
   - 隐藏的列数据不会被删除，只是不显示

2. **批量映射功能**
   - 新增选项卡式界面：单个映射 + 批量映射
   - 批量映射格式：每行一个映射，格式为 `旧料号,新料号`
   - 例如：
     ```
     8.01.1.01.01.206,8.01.1.01.01.233
     8.01.2.01.01.301,8.01.2.01.01.401
     ```
   - 支持同时添加多个映射关系

3. **映射配置自动保存**
   - 映射配置会自动保存到 `material_mapping.json` 文件
   - 程序启动时会自动加载之前的映射配置
   - 不需要每次都重新输入映射关系
   - 支持清空所有映射配置

4. **简化流程**
   - 移除了备份功能（用户可以从系统随时下载）
   - 简化了处理流程，更加高效
   - 减少了不必要的文件操作

### 🎯 使用方法

1. **启动程序**
   - 运行 `python main.py` 或双击 `run.bat`
   - 程序会自动加载之前保存的映射配置

2. **设置映射**
   - **单个映射**：在"单个映射"选项卡中输入旧料号和新料号
   - **批量映射**：在"批量映射"选项卡中输入多行映射数据
   - 点击对应的"添加映射"或"批量添加"按钮

3. **上传文件**
   - 选择销售出库单文件
   - 选择即时库存表文件

4. **开始处理**
   - 点击"开始处理"按钮
   - 程序会自动处理数据并保存结果
   - 修改的单元格会用红色背景高亮显示
   - 无用的列会被自动隐藏

5. **查看结果**
   - 打开处理后的Excel文件
   - 只会显示重要的列，便于检查
   - 修改的内容会用红色高亮显示

### 📋 新增的用户界面功能

1. **选项卡式映射界面**
   - 单个映射选项卡：适合少量映射
   - 批量映射选项卡：适合大量映射

2. **映射管理按钮**
   - "清空映射"：清空所有映射配置
   - 映射会实时显示在下方的文本框中

3. **自动加载提示**
   - 程序启动时会显示加载的映射数量
   - 在日志中显示配置加载信息

### 🔧 技术改进

1. **JSON配置管理**
   - 使用UTF-8编码，支持中文
   - 自动创建和更新配置文件
   - 错误处理和恢复机制

2. **openpyxl直接操作**
   - 直接操作Excel工作簿，确保数据准确性
   - 正确的列位置映射和单元格操作
   - 红色高亮和列隐藏功能

3. **空行处理算法**
   - 检测完全空行并跳过
   - 继续处理空行后的有效数据
   - 保持原始数据结构

### 📝 注意事项

1. **列位置说明**
   - DZ、FF、FG等不是列名，而是指Excel中的列位置
   - 程序会自动根据列位置处理数据

2. **映射配置持久化**
   - 映射配置会自动保存到 `material_mapping.json`
   - 删除此文件会重置所有映射配置

3. **文件格式要求**
   - 支持.xlsx和.xls格式的Excel文件
   - 确保文件包含足够的列数

4. **性能优化**
   - 大文件处理更加高效
   - 空行不会影响处理速度

### 🎉 更新总结

本次更新解决了用户反馈的所有问题：
- ✅ 修复了物料编码不修改的BUG
- ✅ 添加了自动隐藏无用列的功能
- ✅ 实现了批量映射功能
- ✅ 添加了映射配置的自动保存和加载
- ✅ 移除了不必要的备份功能
- ✅ 优化了空行处理逻辑

现在程序更加稳定、高效，用户体验更好！ 